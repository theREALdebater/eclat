-----------------------------------------------------------------------------------------------
# Resources

A _resource_ is a (large) piece of data included in an executable file, for the use of the 
program as it executes. 



-----------------------------------------------------------------------------------------------
## Rationale

It is extremely common for programs to read data from one or more files, in order to obtain 
data that the program uses in its work. 

Ada, as almost all programming languages, provides facilities for a program to open a file that 
resides in (a filesystem of) the host platform (operating system). It identifies the file using 
a name (which can be a rather long and complex path) and reads the data in from the file. The 
program may read, into memory, all of the data in the file, or it may read the data one piece 
at a time. 

Often, a program as delivered to the end user will come in the form of a package (an 
installable package, not an Ada package). The package will contain not only the executable 
file for the program but also a set of data files which the program reads during its 
execution. 

The problem with such accompanying data files is that they are (having been installed, in some 
way, out of the package) separate files existing in a filesystem, and are therefore subject to 
the possibilities of being inappropriately moved, renamed, deleted, or modified. 

If the program relies upon such accompanying files, the program can be (deliberately or 
accidentally) sabotaged by something happening to one or more of those files.

There can be many benefits to having data stored in separate files. But if there are files 
which the program will depend upon, and whose contents will never change whilst the program is 
deployed for the use of an end user, it is possible to bundle thne contents of those files 
into the executable file itself. 

Data files that are made part of the executable file are called _resources_.

ECLAT and the Realizor support including data files as resources in an executable.

In addition, ECLAT and the Realizor support the use of resources within a [dynamically linked 
object](DLL.md) file. 



-----------------------------------------------------------------------------------------------
## .....

Within an image, every resource has a _name_, which also serves as the name of the segment 
it is placed in. The name must be unique among all segments in the image (and therefore 
must also be unique among all resources in the image). 



.....



-----------------------------------------------------------------------------------------------
## .....

.....

A data file can be included into an executable by setting the following configuration item:

    Realizor/X/Resources/R/Source

to the path name of the data file, where `X` is the name of the image, and `R` is the 
name of the resource. 

The data file will be read and its data included into the exectutable generated by the Realizor 
at realisation time. If the file cannot be found at this time, the realisation fails 
(propagating an exception). 

In order to access it directly within the program, an _object_ within the resource (data file) 
must be explicitly configured, by setting: 

    Realizor/X/Resources/R/Export/N
    
to the _offset_ of the object within the resource (data file), where `N` is the name of the 
export. 

The offset is expressed as the number of _paragraphs_ past the beginning of the data in the 
resource (file). The first paragraph is numbered 0. A paragraph is 128 bits (16 bytes) in 
length. The offset must be expressed as a non-negative decimal integer with no spaces or 
punctuation. 

It is typical for a resource to have one export, at offset 0, which has the same name as the 
resource. 

.....

For example:

    Realizor/Frob_Stuff/Resources/Frobnicate_Icon/File = frobnicate.ico
    Realizor/Frob_Stuff/Resources/Frobnicate_Icon/Export/Frobnicate_Icon = 0

.....



-----------------------------------------------------------------------------------------------
## .....

In Ada, the `Import` aspect (or pragma) can be used to make a resource, or part of a resource, 
directly accessible to the program. The external name must be the name of an export from the 
resource, as explicitly configured (see previous section). 

.....

For example:

    pragma Import 



-----------------------------------------------------------------------------------------------
## .....

As an alternative to accessing the resource directly (as described in the previous section), or 
in addition to doing so, a resource can be accessed as if it were a file. 

.....

Any resource with a _filename alias_ `A` can be opened using the file name `#A` thus. 

The filename aliases of a resource R of image X can be configured as the value of the 
configuration item:

    Realizor/X/Resources/R/Aliases = FrobIcon; frob.ico
    
If there are several aliases, they should be separated by a `;` semicolon. For each alias, 
leading and trailing spaces are trimmed but spaces are otherwise left as is. Unlike the 
resource name itself, the syntax restrictions on an alias are much less stringent:

 * ....
 
???The idea is that an alias can simulate the .....

The RTS interprets a file name beginning with `#` .....

.....

    Open (Icon_File, Input_File, "#Frobnicate_Icon");
    
.....

???Form parameter? 

When a resource is read like a file in this way, it is treated as a stream of stream elements, 
and .....

.....



-----------------------------------------------------------------------------------------------
## .....

Each resource is automatically assigned to a segment of the same name as the resource. 

.....




-----------------------------------------------------------------------------------------------
##




-----------------------------------------------------------------------------------------------
##




-----------------------------------------------------------------------------------------------
##




-----------------------------------------------------------------------------------------------
##




-----------------------------------------------------------------------------------------------
##






